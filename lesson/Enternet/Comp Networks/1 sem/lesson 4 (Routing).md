# Маршрутизация

![Dynamic_vs_Static_Route.png](png/lesson4/Dynamic_vs_Static_Route.png)

![Dynamic_vs_Static_Route_2.png](png/lesson4/Dynamic_vs_Static_Route_2.png)

### Статическая маршрутизация. Типы статических маршрутов.

![Static_Route.png](png/lesson4/Static_Route.png)

![Static_Type_Route.png](png/lesson4/Static_Type_Route.png)

```
config()# ip route address maska {address} [disctance]  

{address} - адрес следующего маршрута 
[distance] - административная дистанция
```

**Маршрут следующего перехода.** Указывается только IP-адрес следующего перехода.

![Settings_Static_Route_1.png](png/lesson4/Settings_Static_Route_1.png)

!!!Только для serial!!!

**Полностью заданный статический маршрут.** Указывается только интерфейс выхода
маршрутизатора.

![Settings_Static_Route_2.png](png/lesson4/Settings_Static_Route_2.png)

При использовании Ethernet маршрутизатор не знает, что на конце одно устройство, а не множество, поэтому потребуется в
конце передавать IP-адрес следующего маршрутизатора.

**Статический маршрут по умолчанию**

```
ip route 0.0.0.0 0.0.0.0
```

**Плавающий статический маршрут**

Плавающие статические маршруты — это статические маршруты, используемые для
предоставления резервного пути основному статическому маршруту или динамическому маршруту
на случай сбоя в работе канала. Плавающий статический маршрут используется только тогда, когда
основной маршрут недоступен.
![img.png](png/lesson4/Float_Static_Route.png)

### Динамическая маршрутизация. Классификация протоколов маршрутизации.

Протокол RIP стал одним из первых протоколов маршрутизации. Первая версия (RIPv1) появилась в
1988 г
Наряду с развитием и усложнением сетей возникла необходимость в новых протоколах
маршрутизации. Позднее протокол RIP был обновлен до версии RIPv2, которая лучше
соответствовала потребностям новых крупных сетей того времени.

![Dynamic_Route.png](png/lesson4/Dynamic_Route.png)

Протоклы внутреннего шлюза (IGP) — это протоколы маршрутизации, используемые для обмена информацией о маршрутизации в
домене маршрутизации, управляемом одной организацией. Существует только один EGP и это BGP.

BGP используется для обмена информацией о маршрутизации между различными организациями,
известными как автономные системы (AS)

![Dynamic_Route_2.png](png/lesson4/Dynamic_Route_2.png)

В динамической маршрутизации в больших сетях подразумевается частое изменение топологии, т.е какие-то сети могут
добавляться/отпадывать сети.

### Задачи протоколов маршрутизации. Компоненты.

![Protocol_Dynamic_Route.png](png/lesson4/Protocol_Dynamic_Route.png)

Протоколы динамической маршрутизации включают в себя следующие компоненты:

*	Структуры данных: таблицы/базы данных (в RAM).
*	Сообщения протокола маршрутизации: для обнаружения соседей, обмена информацией.
*	Алгоритм: для обмена данными и определения оптимального пути.


### Алгоритм работы протокола маршрутизации

![Algoritm_Work_Protocol_ROute.png](png/lesson4/Algoritm_Work_Protocol_ROute.png)

![example_1.png](png/lesson4/example_1.png)

![example_2.png](png/lesson4/example_2.png)

### RIP: определение, описание, версии, принцип работы

Протокол RIP — протокол маршрутизации первого поколения для среды IPv4, изначально указанный в RFC 1058.
Настройка этого протокола достаточно проста, что делает его оптимальным протоколом для реализации в небольших
сетях.

![RIP.png](png/lesson4/RIP.png)

``` 
(config)# router rip
(conf-router)# version 2
network ip_network  - какие сети участвуют в обмене сообщениями.  
  2 функции: указать какие сети будут вещать и указать какие интерфейсы
      являются частью домена маршрутизации выбранного протокола
```

![show_ip_protocols.png](png/lesson4/show_ip_protocols.png)

![Class_Network.png](png/lesson4/Class_Network.png)

Класс определяется по первым битам.
Сеть – это классовая сеть. Все сети, которые не относятся к классовому разделению, являются
подсетями.

Если хотим отдельно учитывать адреса на каждом интерфейсе:

![No_Auto_Summary.png](png/lesson4/No_Auto_Summary.png)

Интерфейсы в которые мы не хотим распространять служебные сообщения протоколов
маршрутизации, но хотим рассказывать об этих сетях. Не хотим посылать в сеть где клиенты
подключены служебные сообщения.

![Passive_int.png](png/lesson4/Passive_int.png)

Нужно для увелечения безопасности.

![Default_Getway.png](png/lesson4/Default_Getway.png)

default-information originate - позволяет протоколу rip распространить маршрут по умолчанию

### Записи таблицы маршрутизации. Вид и устройство таблицы маршрутизации.

![Topology.png](png/lesson4/Topology.png)

![Table_Route.png](png/lesson4/Table_Route.png)

1. Источник маршрута(удаленная(static, rip) или напрямую подключенная (local,
   connected))
2. Сеть назначения
3. Степень доверия источнику маршрута. Чем меньше число, тем больше
   доверяют
4. Метрика (расстояние до сети). Чем меньше метрика, чем оптимальнее
   маршрут.
5. Адрес следующего маршрутизатора
6. Исходящий интерфейс

![termins.png](png/lesson4/termins.png)

Вертикальная иерархия. Смещение слева (неровные столбики)

1. Окончательные маршруты
2. Маршруты уровня 1
3. Родительский маршрут уровня 1
4. Дочерние маршруты второго уровня

![Ultimate_Route.png](png/lesson4/Ultimate_Route.png)

Строчка которой можно воспользоваться для отправки трафика. По ней сразу известно куда
отправить трафик. Оранжевым цветом. Указан либо интерфейс, либо адрес следующего
маршрутизатора, либо и то и другое

![level_1_route.png](png/lesson4/level_1_route.png)

Маска меньше чем классовая.
Либо классовая сеть, либо объединение сетей, либо маршрут по умолчанию.

![level_1_parent_route.png](png/lesson4/level_1_parent_route.png)

Классовая сеть, которая не указывает куда дальше отправиться трафику. Ей нельзя
воспользоваться, чтобы отправить трафик.

![level_2_child_route.png](png/lesson4/level_2_child_route.png)

Подсети родительских сетей. Являются окончательными.

### Процесс поиска маршрута по таблице маршрутизации.

![Process_Find_Route_Table_1.png](png/lesson4/Process_Find_Route_Table_1.png)

Пришел пакет. Сперва просматриваются маршруты первого уровня, которые окончательные. С
наилучшим совпадением по маске.

![Process_Find_Route_Table_2.png](png/lesson4/Process_Find_Route_Table_2.png)

В первый уровень также попадают родительские маршруты. Если совпали с записью родительского
маршрута (который не является окончательным), тогда смотрим по дочерним маршрутам.

![Process_Find_Route_Table_3.png](png/lesson4/Process_Find_Route_Table_3.png)

Дальше переходим к следующей записи. Суперсеть – объединение сетей. Маска меньше и
совпадение требуется то.е меньше. Если не совпали и нет маршрута по умолчанию, то отбрасываем
пакет.  
Плюс в том, что если нет совпадений по родительским маршрутам, то и дочерние смотреть не
нужно. А это большой блок данных.
Статический маршрут лучше указывать полностью, иначе придется делать поиск по таблице
маршрутизации 2 раза. Второй чтобы найти выходящий интерфейс.
