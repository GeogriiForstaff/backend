# Динамическая маршрутизация. Протокол OSPF

## Протоколы состояния канала

### Классификация

![class_routing.png](img/lesson6/class_routing.png)

### Алгоритм работы состояния канала

Задача протокола - обеспечить одинаковую информацию на всех маршрутизаторах, которые работают с этим протоколом
состояния канала

![link_state_protocol.png](img/lesson6/link_state_protocol.png)

Алгоритм:

1. Изучает подключенные сети
2. Каждый маршрутизатор выявляет своих соседей с помощью Hello сообщений и с помощью этих сообщений поддерживает
   связанность со своими соседями
3. После выяснения соседей каждый маршрутизатор рассылает пакет состояния канала (LSP)
4. Каждый маршрутизатор, который получил такой пакет, должен лавинно разослать его всем своим соседям
5. Каждый маршрутизатор заносит в свою базу данных, на основе этой БД строится топология сети и рассчитывается
   оптимальный маршрут

Рассмотрим на примере R1

![R1.png](img/lesson6/R1.png)

Отправка хэлоу сообщений

![Hello.png](img/lesson6/Hello.png)

Создастся 4 пакета LSP и КАЖДЫЙ пакет будет переслан всем соседям

![LSP.png](img/lesson6/LSP.png)

Далее Каждый маршрутизатор должен незамедлительно разослать этот LSP пакет дальше, т.е каждый маршрутизатор продублирует
на все свои настроенные интерфейсы полученный LSP пакет, кроме того интерфейса с которого был получен пакет. (Это и есть
лавинная рассылка)

Такой рассылкой мы гарантируем, что каждый маршрутизатор в топологии получит этот пакет.

![LSP2.png](img/lesson6/LSP2.png)

Все маршрутизаторы в топологии должны иметь одинаковую базу данных.

![LSD.png](img/lesson6/LSD.png)

SPF - алгоритм Дейкстры

![SPF_Tree.png](img/lesson6/SPF_Tree.png)

![table_route.png](img/lesson6/table_route.png)

### Приемущества и недостатки

![+_-.png](img/lesson6/%2B_-.png)

### Иерархия Протоколов состояния каналов

Протоколы состояния канала придерживаются иерархичность(разделению на области)

![Area.png](img/lesson6/Area.png)

В каждой области будет происходить полный процесс работы протокола, т.е только внутри какой-то области будет полностью
совпадать база данных

Между областями передается сокращенная информация, любое изменение в одной области не трегерит пересчет пути в других
областях, что экономит ресурсы ЦП

**!НО** только при правильном планировании иерархичности IP адресов возможна такая работа

### OSPF and IS-IS

![OSPF_IS-IS.png](img/lesson6/OSPF_IS-IS.png)

---------------------------------

## Принципы работы OSPF

### Компоненты OSPF

![OSPF_Component.png](img/lesson6/OSPF_Component.png)

3 типа базы данных используется:

1. База смежности - база соседних маршрутизаторов, с которыми удалось вступить в соседство. Строится таблица соседей
2. База данных состояния канала - именно она главный отличительный признак протокола состояния канала. Все сообщения
   состояния канала от всех маршрутизаторов в топологии, по ней делается таблица топологии
3. База данных пересылки - строится по базе данных состояния канала, строится по результату поиска минимального пути(т.е
   по Алгоритму Дейкстры). Строится таблица маршрутизации

### Принцип работы

Сначала устанавливаются смежности с соседями с помощью Hello пакетов

После установки смежности между маршрутизаторами происходит обмен LSA сообщениями. Действует принцип лавинной рассылки

![OSPF_Work.png](img/lesson6/OSPF_Work.png)

На полученные LSA сообщения каждым маршрутизатором, попадают в базу данных состояния канала на основе которой строится
таблица топологии

![OSPF_Work2.png](img/lesson6/OSPF_Work2.png)

После на базе данных состояния каналов запускается алгоритм Дейкстры и стройтся дерево SPF. уже учитываются стоимости
пути

![OSPF_Work3.png](img/lesson6/OSPF_Work3.png)

Лучший вычисленный маршрут вносится в таблицу маршрутизации

![OSPF_Work4.png](img/lesson6/OSPF_Work4.png)

**ВАЖНО ПОНИМАТЬ** разница протоколов состояния канала от всех других в том, что у каждого маршрутизатора должны быть
совпадающие базы данных состояния каналов, на которых строится дерево. А вот таблицы маршрутизации у каждого
маршрутизатора своя.

### Виды OSPF

![type_OSPF.png](img/lesson6/type_OSPF.png)

Single-area - обычный способ построения сети

Multiarea - отдельная особенность внедрение иерархии, что позволяет всю нашу сеть разделить на несколько частей. Каждая
отдельная область, работает как single-area + есть взаимодействие между другими областями

### Преимущества Multiarea

![Multiarea.png](img/lesson6/Multiarea.png)

Обязательно должна быть Area 0 - является магистральной областью

### Типы пакетов OSPF

![type_packets_OSPF.png](img/lesson6/type_packets_OSPF.png)

### LSA сообщения

![LSA_message.png](img/lesson6/LSA_message.png)

### Состояния OSPF

![OSPF_state.png](img/lesson6/OSPF_state.png)

----------------------------------------

## Настройка OSPF

![setting_OSPF.png](img/lesson6/setting_OSPF.png)

![setting_OSPF2.png](img/lesson6/setting_OSPF2.png)

### Метрика = Стоимость пути

![Metric.png](img/lesson6/Metric.png)

![autocost_reference_bandwidth.png](img/lesson6/autocost_reference_bandwidth.png)

### Изменение стоимости/пропускной способности

![reset_cost.png](img/lesson6/reset_cost.png)

### Команды проверки

![show_setting.png](img/lesson6/show_setting.png)

----------------------------------------

## OSPFv3

Работает также, как и OSPFv2: использует те же алгоритмы поиска, разница только в сетевом протоколе (IPv4 or IPv6)

### Сходства OSPF v3 с v2

![OSPF_v2_v3.png](img/lesson6/OSPF_v2_v3.png)

### Различия OSPF v2 и v3

![OSPF_v3_vs_v2.png](img/lesson6/OSPF_v3_vs_v2.png)